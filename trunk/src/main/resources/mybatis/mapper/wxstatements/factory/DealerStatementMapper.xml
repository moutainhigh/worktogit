<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lwxf.industry4.webapp.domain.dao.statements.factory.dealerStatement.DealerStatementDao">
    <select id="findDealerStatementByWeek" resultType="com.lwxf.industry4.webapp.domain.dto.statement.CountByWeekDto">
        <if test="countType != null and countType != ''and countType =='0'.toString()">
            <![CDATA[
            select
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d')  <=  (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-1))) as mon,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d')  <=  (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-2))) as tues,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d')  <=  (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-3))) as wed,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d')  <= (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-4))) as thur,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d')  <=  (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-5))) as fri,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d')  <=  (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-6))) as sat,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d')  <=  (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-7))) as sun
            ]]>
        </if>
        /**/
        <if test="countType != null and countType != ''and countType =='1'.toString()">
            <![CDATA[
            select
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-1))) as mon,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-2))) as tues,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-3))) as wed,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-4))) as thur,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-5))) as fri,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-6))) as sat,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and date_format(contract_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-7))) as sun
            ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='2'.toString()">
            <![CDATA[
            select
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2 and date_format(retire_net_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-1))) as mon,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2 and date_format(retire_net_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-2))) as tues,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2 and date_format(retire_net_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-3))) as wed,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2 and date_format(retire_net_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-4))) as thur,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2 and date_format(retire_net_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-5))) as fri,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2 and date_format(retire_net_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-6))) as sat,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2 and date_format(retire_net_time,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-7))) as sun
            ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='3'.toString()">
            <![CDATA[
            select
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and date_format(created,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-1))) as mon,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and date_format(created,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-2))) as tues,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and date_format(created,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-3))) as wed,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and date_format(created,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-4))) as thur,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and date_format(created,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-5))) as fri,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and date_format(created,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-6))) as sat,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and date_format(created,'%Y-%m-%d') = (select subdate(curdate(),if(date_format(curdate(),'%w')=0,7,date_format(curdate(),'%w'))-7))) as sun
            ]]>
        </if>
    </select>

    <select id="findDealerStatementByMonth" resultType="com.lwxf.industry4.webapp.domain.dto.statement.CountByMonthDto">
        <if test="countType != null and countType != ''and countType =='0'.toString()">
            <![CDATA[
      select
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and   date_format(contract_time,'%Y-%m-%d') < date_format(#{twoTime},'%Y-%m-%d') )  as point1,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and   date_format(contract_time,'%Y-%m-%d') < date_format(#{threeTime},'%Y-%m-%d')) as point2,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and   date_format(contract_time,'%Y-%m-%d') < date_format(#{fourTime},'%Y-%m-%d')) as point3,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1 and   date_format(contract_time,'%Y-%m-%d') <= date_format(#{fiveTime},'%Y-%m-%d')) as point4
       ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='1'.toString()">
            <![CDATA[
      select
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and date_format(contract_time,'%Y-%m-%d') >= date_format(#{oneTime},'%Y-%m-%d') and date_format(contract_time,'%Y-%m-%d')   < date_format(#{twoTime},'%Y-%m-%d'))  as point1,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and date_format(contract_time,'%Y-%m-%d') >= date_format(#{twoTime},'%Y-%m-%d') and date_format(contract_time,'%Y-%m-%d')   < date_format(#{threeTime},'%Y-%m-%d')) as point2,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and date_format(contract_time,'%Y-%m-%d') >= date_format(#{threeTime},'%Y-%m-%d') and date_format(contract_time,'%Y-%m-%d') < date_format(#{fourTime},'%Y-%m-%d')) as point3,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and date_format(contract_time,'%Y-%m-%d') >= date_format(#{fourTime},'%Y-%m-%d') and date_format(contract_time,'%Y-%m-%d') <= date_format(#{fiveTime},'%Y-%m-%d')) as point4
       ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='2'.toString()">
            <![CDATA[
      select
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and date_format(retire_net_time,'%Y-%m-%d') >= date_format(#{oneTime},'%Y-%m-%d') and date_format(retire_net_time,'%Y-%m-%d')   < date_format(#{twoTime},'%Y-%m-%d'))  as point1,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and date_format(retire_net_time,'%Y-%m-%d') >= date_format(#{twoTime},'%Y-%m-%d') and date_format(retire_net_time,'%Y-%m-%d')   < date_format(#{threeTime},'%Y-%m-%d')) as point2,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and date_format(retire_net_time,'%Y-%m-%d') >= date_format(#{threeTime},'%Y-%m-%d') and date_format(retire_net_time,'%Y-%m-%d') < date_format(#{fourTime},'%Y-%m-%d')) as point3,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and date_format(retire_net_time,'%Y-%m-%d') >= date_format(#{fourTime},'%Y-%m-%d') and date_format(retire_net_time,'%Y-%m-%d') <= date_format(#{fiveTime},'%Y-%m-%d')) as point4
       ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='3'.toString()">
            <![CDATA[
     select
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0  and date_format(created,'%Y-%m-%d') >= date_format(#{oneTime},'%Y-%m-%d') and date_format(created,'%Y-%m-%d')   < date_format(#{twoTime},'%Y-%m-%d'))  as point1,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0  and date_format(created,'%Y-%m-%d') >= date_format(#{twoTime},'%Y-%m-%d') and date_format(created,'%Y-%m-%d')   < date_format(#{threeTime},'%Y-%m-%d')) as point2,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0  and date_format(created,'%Y-%m-%d') >= date_format(#{threeTime},'%Y-%m-%d') and date_format(created,'%Y-%m-%d') < date_format(#{fourTime},'%Y-%m-%d')) as point3,
       (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0  and date_format(created,'%Y-%m-%d') >= date_format(#{fourTime},'%Y-%m-%d') and date_format(created,'%Y-%m-%d') <= date_format(#{fiveTime},'%Y-%m-%d')) as point4
       ]]>
        </if>
    </select>

    <select id="findDealerStatementByQuarter"
            resultType="com.lwxf.industry4.webapp.domain.dto.statement.CountByQuarterDto">
        <if test="countType != null and countType != ''and countType =='0'.toString()">
            <![CDATA[
            select
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and date_format(contract_time,'%m')  <=  #{firstMonth}) as month1,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and date_format(contract_time,'%m')  <=  #{secondMonth}) as month2,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and date_format(contract_time,'%m')  <=  #{thirdMonth}) as month3
            ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='1'.toString()">
            <![CDATA[
            select
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and  month(contract_time)=#{firstMonth}) as month1,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and  month(contract_time)=#{secondMonth}) as month2,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and  YEAR(contract_time)=YEAR(NOW()) and  month(contract_time)=#{thirdMonth}) as month3
            ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='2'.toString()">
            <![CDATA[
            select
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and  month(retire_net_time)=#{firstMonth}) as month1,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and  month(retire_net_time)=#{secondMonth}) as month2,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and  month(retire_net_time)=#{thirdMonth}) as month3
            ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='3'.toString()">
            <![CDATA[
            select
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and  month(created)=#{firstMonth}) as month1,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and  month(created)=#{secondMonth}) as month2,
            (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and   month(created)=#{thirdMonth}) as month3
            ]]>
        </if>
    </select>

    <select id="findDealerStatementByYear" resultType="com.lwxf.industry4.webapp.domain.dto.statement.CountByYearDto">
        <if test="countType != null and countType != ''and countType =='0'.toString()">
            <![CDATA[
        select
         (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=1) as jan,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=2) as feb,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=3) as mar,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=4) as apr,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=5) as may,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=6) as jun,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=7) as jul,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=8) as aug,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=9) as sept,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=10) as oct,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=11) as nov,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)<=12) as dece
        ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='1'.toString()">
            <![CDATA[
        select
         (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=1) as jan,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=2) as feb,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=3) as mar,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=4) as apr,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=5) as may,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=6) as jun,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=7) as jul,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=8) as aug,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=9) as sept,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=10) as oct,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=11) as nov,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=1  and YEAR(contract_time)=YEAR(NOW()) and month(contract_time)=12) as dece
        ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='2'.toString()">
            <![CDATA[
        select
         (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=1) as jan,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=2) as feb,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=3) as mar,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=4) as apr,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=5) as may,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=6) as jun,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=7) as jul,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=8) as aug,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=9) as sept,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=10) as oct,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=11) as nov,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=2  and YEAR(retire_net_time)=YEAR(NOW()) and month(retire_net_time)=12) as dece
        ]]>
        </if>
        <if test="countType != null and countType != ''and countType =='3'.toString()">
            <![CDATA[
        select
         (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=1) as jan,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=2) as feb,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=3) as mar,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=4) as apr,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=5) as may,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=6) as jun,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=7) as jul,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=8) as aug,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=9) as sept,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=10) as oct,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=11) as nov,
        (select count(*) from company where type!=0 and branch_id=#{branchId} and status=0 and YEAR(created)=YEAR(NOW()) and month(created)=12) as dece
        ]]>
        </if>
    </select>


    <!-- 大数据首页接口sql-->
    <select id="queryDealerData" resultType="java.util.Map">
        SELECT
        <!-- 经销商总数 -->
        (select count(*) from company where type <![CDATA[ != ]]> 0 and type <![CDATA[ != ]]> 6 and (status=0 or
        status=1))dealerTotal,
        <!-- 签约经销商 -->
        ((select count(*) from company where status=1 and type <![CDATA[ != ]]> 0 and type <![CDATA[ != ]]> 6
        ))dealersginin,
        <!-- 意向经销商 -->
        (select count(*) from company where status = 0 and type &lt; 6 and type != 0)dealerintention,
        <!--  即将到期 -->
        (select count(*) from company where type &lt; 6 and (contract_expired_date != '' or contract_expired_date!=null)
        and to_days(contract_expired_date) - (to_days(NOW()) ) &lt; 30 and contract_expired_date > NOW())
        dealerTobeOutOfDate,
        <!--  已过期 -->
        (select count(*) from company where type &lt; 6 and (contract_expired_date != '' or contract_expired_date!=null)
        and contract_expired_date &lt; NOW()) dealerOutOfDate,
        <!--  直营店 -->
        (select count(*) from company where type = 1 ) directSaleStore,
        <!--  店中店 -->
        (select count(*) from company where type = 2 ) storeInStore,
        <!-- 专卖店 -->
        (select count(*) from company where type = 3 ) exclusiveShop,
        <!-- 加盟店 -->
        (select count(*) from company where type = 4 ) franchiseeShop,
        <!-- 散户 -->
        (select count(*) from company where type = 5 ) retailInvestorShop
        from dual
    </select>
    <!--查询产品生产数据-->
    <select id="queryProductData" resultType="java.util.Map">
        SELECT
        <!--  待生产 -->
        (	SELECT count(*) from order_product WHERE status='1' )toBeProduced,
        <!--  生产中 -->
        (SELECT count(*) from order_product WHERE status='2' )inProduced,
        <!--  即将逾期 -->
        (SELECT count(*) from order_product WHERE status='2' and (to_days(plan_finish_time) - to_days(NOW())) &lt;= 3
        AND plan_finish_time > NOW()) tobeOverdue,
        <!--  已逾期 -->
        (SELECT
        count( * )
        FROM
        order_product op
        WHERE
        op.STATUS >= '1'
        AND op.STATUS <![CDATA[ < ]]> '5'
        AND DATE_FORMAT( op.plan_order_finish_time, '%Y-%m-%d' ) <![CDATA[ < ]]>DATE_FORMAT( now( ), '%Y-%m-%d' )  ) overdue
        from dual
    </select>

    <select id="queryOwnerStateData" resultType="java.util.Map">
        <!-- 自产 12个月折线图-->
        SELECT count(*) total,year(py.audited) yearDate, month(py.audited) monthdate from custom_order co LEFT JOIN
        payment py ON py.custom_order_id = co.id
        WHERE py.audited is not null
        and DATE_FORMAT(py.audited ,'%Y') = DATE_FORMAT(NOW(),'%Y')
        group by year(py.audited),
        month(py.audited)
    </select>

    <select id="queryOutStateData" resultType="java.util.Map">
        <!-- 外协 12个月折线图-->
        SELECT count(*)total,year(py.audited)yearDate, month(py.audited)monthdate from custom_order co LEFT JOIN payment
        py ON py.custom_order_id = co.id
        WHERE py.audited is not null
        and DATE_FORMAT(py.audited ,'%Y') = DATE_FORMAT(NOW(),'%Y')
        and is_coordination = 1
        group by year(py.audited),
        month(py.audited)
    </select>

    <select id="queryAftererSaleStateData" resultType="java.util.Map">
        <!-- 售后 12个月折线图-->
        SELECT count(*)total,year(py.audited)yearDate, month(py.audited)monthdate from custom_order co LEFT JOIN payment
        py ON py.custom_order_id = co.id
        WHERE py.audited is not null
        and DATE_FORMAT(py.audited ,'%Y') = DATE_FORMAT(NOW(),'%Y')
        and co.type = 1
        group by year(py.audited),
        month(py.audited)

    </select>

    <select id="queryRepertoryData" resultType="java.util.Map">
        <!-- 库存统计-->
        -- 库存统计
        SELECT
        <!-- 未入库柜体-->
        (select count(*) from produce_order where  count is null and type=0 and order_product_id in(select id from order_product where status='2')
        )cabinet,
        <!--  未入库门板-->
        (select count(*) from produce_order where  count is null and type=1 and order_product_id in(select id from order_product where status='2')
        )doorPlank,
        <!--  未入库五金-->
        (select count(*) from produce_order where  count is null and type=2 and order_product_id in(select id from order_product where status='2')
        ) hardware
        from dual
    </select>
    <!-- 订单总数-->
    <select id="queryTotalOrderData" resultType="java.util.Map">
      SELECT count(*) total from custom_order co
	  LEFT JOIN payment py ON co.id = py.custom_order_id where py.audited is not null
    </select>

    <!-- 订单饼状图-->
    <select id="queryOrderPieChartData" resultType="java.util.Map">

       		SELECT count(*) count, order_product_type orderProductType,bc.`value` from  order_product  op
				LEFT JOIN	custom_order co on op.custom_order_id = co.id
        LEFT JOIN payment py ON co.id = py.custom_order_id
				LEFT JOIN basecode bc on bc.code = co.order_product_type
        WHERE
        py.audited is not null and  bc.type= 'orderProductType'
        GROUP BY
        order_product_type

    </select>

    <!-- 自产 折线图-->
    <select id="queryOwnLineChartData" resultType="java.util.Map">
        select count(*) count,order_product_type orderProductType  from custom_order  co
        LEFT JOIN payment py ON co.id = py.custom_order_id
        WHERE
        py.audited is not null GROUP BY order_product_type
    </select>
    <!-- 外协 折线图-->
    <select id="queryOutOrderLineChartData" resultType="java.util.Map">
            SELECT count(*) total,year(py.audited) yearDate, month(py.audited) monthDate from custom_order co LEFT JOIN payment py ON py.custom_order_id = co.id
            WHERE py.audited is not null and
             is_coordination = 1
</select>
    <!-- 售后 折线图-->
    <select id="queryAfterSalOrderLineChartData" resultType="java.util.Map">
      SELECT count(*) total,year(py.audited) yearDate, month(py.audited) monthDate from custom_order co LEFT JOIN payment py ON py.custom_order_id = co.id
      WHERE py.audited is not null
      and co.type = 1
    </select>

    <!--本月 本年 去年本月 去年 -->
    <select id="queryNowMonthYearOrderData" resultType="java.util.Map">
        SELECT
        (select count(*) from custom_order co  where  DATE_FORMAT((co.commit_time),'%Y-%m') = DATE_FORMAT(now(),'%Y-%m'))nowMonth,
        (select count(*) from custom_order co  where  DATE_FORMAT((co.commit_time),'%Y-%m') = DATE_FORMAT(date_add(now(), interval -1 year),'%Y-%m'))lastYearNowMonth,
        (select count(*) from custom_order co  where  DATE_FORMAT((co.commit_time),'%Y') = DATE_FORMAT(now(),'%Y'))nowYear,
        (select count(*) from custom_order co  where  DATE_FORMAT((co.commit_time),'%Y') = DATE_FORMAT(date_add(now(), interval -1 year),'%Y'))lastYear
        from dual
    </select>

    <!-- 财务数据分析-->
    <select id="queryFinanceData" resultType="java.util.Map">


        SELECT
        <!--  今日成交额-->
        (SELECT  COALESCE(SUM(amount),0) FROM payment where DATE_FORMAT(audited,'%Y%m%d') = DATE_FORMAT(NOW(),'%Y%m%d') and funds='31') nowDayTurnover,
        <!-- 今日实付-->
        (SELECT  COALESCE(SUM(pay_amount),0) FROM payment where DATE_FORMAT(audited,'%Y%m%d') = DATE_FORMAT(NOW(),'%Y%m%d')and funds='31') nowDayPay,
        <!--  今日挂账-->
        (SELECT   COALESCE(SUM(amount)-SUM(pay_amount),0) FROM payment where DATE_FORMAT(audited,'%Y%m%d') = DATE_FORMAT(NOW(),'%Y%m%d')and funds='31')nowDayCharge,
        <!--  本月成交额-->
        (SELECT COALESCE(SUM(amount),0) FROM payment where DATE_FORMAT(audited,'%Y%m') = DATE_FORMAT(NOW(),'%Y%m')and funds='31') nowMonthTurnover,
        <!--  本月实付-->
        (SELECT COALESCE(SUM(pay_amount),0) FROM payment where DATE_FORMAT(audited,'%Y%m') = DATE_FORMAT(NOW(),'%Y%m')and funds='31') nowMonthPay,
        <!--   本月挂账-->
        (SELECT COALESCE(SUM(amount)-SUM(pay_amount),0) FROM payment where DATE_FORMAT(audited,'%Y%m') = DATE_FORMAT(NOW(),'%Y%m')and funds='31')nowMonthCharge,
        <!-- 本年成交额-->
        (SELECT   COALESCE(SUM(amount),0) FROM payment where DATE_FORMAT(audited,'%Y') = DATE_FORMAT(NOW(),'%Y')and funds='31') lastYearTurnover,
        <!--  本年实付-->
        (SELECT   COALESCE(SUM(pay_amount),0) FROM payment where DATE_FORMAT(audited,'%Y') = DATE_FORMAT(NOW(),'%Y')and funds='31')lastYearPay,
        <!--   本年挂账-->
        (SELECT  COALESCE(SUM(amount)-SUM(pay_amount),0) FROM payment where DATE_FORMAT(audited,'%Y') = DATE_FORMAT(NOW(),'%Y')and funds='31')lastYearCharge
        from dual
    </select>

    <!-- 财务分析 饼状图 今年-->
    <select id="queryFinancePieChartYearData" resultType="java.util.Map">
          select bc.value name,SUM(py.amount) count,order_product_type  from custom_order co
        LEFT JOIN payment py ON co.id = py.custom_order_id
        LEFT JOIN basecode bc on bc.code = co.order_product_type
        WHERE py.audited is not null
        and DATE_FORMAT(audited,'%Y') = DATE_FORMAT(NOW(),'%Y')
        and bc.type='orderProductType'
        GROUP BY order_product_type
    </select>

    <!-- 财务分析 饼状图 今年-->
    <select id="queryFinancePieChartMonthData" resultType="java.util.Map">
        select bc.value name, SUM(py.amount) count,order_product_type  from custom_order co
        LEFT JOIN payment py ON co.id = py.custom_order_id
				LEFT JOIN basecode bc on bc.code = co.order_product_type
        WHERE  py.audited is not null
        and DATE_FORMAT(audited,'%Y%m') = DATE_FORMAT(NOW(),'%Y%m')
				and bc.type='orderProductType'
        GROUP BY order_product_type
    </select>

    <!-- 财务数据分析 本年 去年 本月 上个月-->
    <select id="queryFinanceTotalComparisonData" resultType="java.util.Map">
         select
        (select COALESCE(SUM(py.amount),0) count from custom_order co
        LEFT JOIN payment py ON co.id = py.custom_order_id
        WHERE  py.audited is not null
        and DATE_FORMAT(audited,'%Y%m') = DATE_FORMAT(NOW(),'%Y%m')) monthTotal,
        (select COALESCE(SUM(py.amount),0) count from custom_order co
        LEFT JOIN payment py ON co.id = py.custom_order_id
        WHERE py.audited is not null
        and DATE_FORMAT(audited,'%Y%m') = DATE_FORMAT(date_add(now(), interval -1 MONTH),'%Y%m'))lastMonthTotal,
        (select COALESCE(SUM(py.amount),0) count from custom_order co
        LEFT JOIN payment py ON co.id = py.custom_order_id
        WHERE   py.audited is not null
        and DATE_FORMAT(audited,'%Y') = DATE_FORMAT(NOW(),'%Y')
				)yearTotal,
        (select COALESCE(SUM(py.amount),0)  count  from custom_order co
        LEFT JOIN payment py ON co.id = py.custom_order_id
        WHERE py.audited is not null
        and DATE_FORMAT(audited,'%Y') = DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y')
        )lastYearTotal
        from dual
    </select>
    <!-- 员工信息统计 部门排序-->
    <select id="queryDeptMemberData" resultType="java.util.Map">
        select dt.name,count(*) total from dept_member  dm
        LEFT JOIN dept dt ON dm.dept_id = dt.id
        GROUP BY dept_id
    </select>

    <!--查询待发货 已发货数据-->
    <select id="queryDeliverData" resultType="java.util.Map">
        select
        (SELECT count(*) from (SELECT co.id from custom_order co
        LEFT JOIN order_product op  ON op.custom_order_id = co.id
        where co.status= #{hasDeliver}
        GROUP BY co.id ) t) deliverOder,
        (SELECT count(*) from (SELECT co.id from custom_order co
        LEFT JOIN order_product op  ON op.custom_order_id = co.id
        where co.status= #{toDeliver}
        GROUP BY co.id ) t
        )toDeliverOder
        from dual
    </select>
    <!--经销商销售金额-->
    <select id="queryDealerSellOrder" resultType="java.util.Map">
    select cp.name,count(*) sellOrderTotal,sum(co.factory_final_price) sellMoneyTotal
    from custom_order co
    LEFT JOIN payment py ON co.id = py.custom_order_id
    LEFT JOIN company cp ON cp.id = co.company_Id
    where <![CDATA[ co.status >1 and  co.status <=7 ]]>
    GROUP BY co.company_Id
    ORDER BY sellMoneyTotal DESC
    limit 4
    </select>
    <select id="queryLogisticsOrder" resultType="java.util.Map">
        SELECT lc.name,count(*) total FROM dispatch_bill dp LEFT JOIN logistics_company lc on dp.logistics_company_id = lc.id
        GROUP BY logistics_company_id
    </select>

    <select id="findDealerNumGroupByType" resultType="java.util.Map">
        SELECT count(c.id) total,c.type,b.value typeName FROM company   c
        LEFT JOIN basecode b on c.type=b.code and b.type='dealerType'
        where c.branch_id=#{branchId} and c.type <![CDATA[ != ]]> 0 and c.type <![CDATA[ != ]]> 6
        GROUP BY c.type
    </select>


    <!--今年十二个月订单总数-->
    <select id="queryNowYearData" resultType="java.util.Map">
    SELECT
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited !=''
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"01")) orderTatalmonth1,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"02"))orderTatalmonth2,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"03"))orderTatalmonth3,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"04"))orderTatalmonth4,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"05"))orderTatalmonth5,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"06"))orderTatalmonth6,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"07"))orderTatalmonth7,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"08"))orderTatalmonth8,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"09"))orderTatalmonth9,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"10"))orderTatalmonth10,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"11"))orderTatalmonth11,
    (select count(*) orderTotal from custom_order co
    LEFT JOIN payment py on co.id = py.custom_order_id
    where py.audited is not null
    and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(now(),'%Y'),"12"))orderTatalmonth12
    from dual
    </select>

    <select id="queryLastYearData" resultType="java.util.Map">

SELECT
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"01"))orderTatalmonth1,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"02"))orderTatalmonth2,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"03"))orderTatalmonth3,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"04"))orderTatalmonth4,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"05"))orderTatalmonth5,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"06"))orderTatalmonth6,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"07"))OrderTatalmonth7,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"08"))orderTatalmonth8,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"09"))orderTatalmonth9,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"10"))orderTatalmonth10,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"11"))orderTatalmonth11,
(select count(*) orderTotal from custom_order co
LEFT JOIN payment py on co.id = py.custom_order_id
where py.audited is not null
and DATE_FORMAT(py.audited,'%Y%m') = CONCAT(DATE_FORMAT(date_add(now(), interval -1 YEAR),'%Y'),"12"))orderTatalmonth12
from dual

    </select>
    <!--查询 自产外协售后总订单数-->
    <select id="queryTotalOrderByTypeData" resultType="java.util.Map">
    select
    (SELECT count(*)  from custom_order co LEFT JOIN payment py ON py.custom_order_id = co.id
    WHERE py.audited is not null )ownOrderTatal,
    (SELECT count(*)  from custom_order co LEFT JOIN payment py ON py.custom_order_id = co.id
    WHERE py.audited is not null  and
     is_coordination = 1)outOrderTotal,
    (SELECT count(*)from custom_order co LEFT JOIN payment py ON py.custom_order_id = co.id
    WHERE py.audited is not null
    and co.type = 1) afterSaleTotal
    from dual
    </select>


    <select id="findDealerStatements" resultType="integer">
        <if test="countType != null and countType != ''and countType =='0'.toString()">
            select
            (select count(*) from company
            <where>
                <trim prefixOverrides="AND">
                    type <![CDATA[ != ]]> 0 and branch_id=#{branchId} and status=1
                    <if test="date != null">
                        and date_format(contract_time,'%Y-%m-%d') <![CDATA[ <= ]]> date_format(#{date},'%Y-%m-%d')
                    </if>
                    <if test="beginDate != null and endDate != ''">
                        <![CDATA[
                and  date_format(contract_time,'%Y-%m-%d') >= #{beginDate} and date_format(contract_time,'%Y-%m-%d') <= #{endDate}
                ]]>
                    </if>

                    <if test="cityId != null">
                        and city_area_id=#{cityId}
                    </if>
                    <if test="salesmanId != null">
                        AND business_manager=#{salesmanId}
                    </if>
                </trim>
            </where>
            ) as count
        </if>
        <if test="countType != null and countType != ''and countType =='1'.toString()">
            select
            (select count(*) from company
            <where>
                <trim prefixOverrides="AND">
                    type!=0 and branch_id=#{branchId} and status=1
                    <if test="date != null">
                        and date_format(contract_time,'%Y-%m-%d') = date_format(#{date},'%Y-%m-%d')
                    </if>
                    <if test="beginDate != null and endDate != ''">
                        <![CDATA[
                and  date_format(contract_time,'%Y-%m-%d') >= #{beginDate} and date_format(contract_time,'%Y-%m-%d') <= #{endDate}
                ]]>
                    </if>
                    <if test="cityId != null">
                        and city_area_id=#{cityId}
                    </if>
                    <if test="salesmanId != null">
                        AND business_manager=#{salesmanId}
                    </if>
                </trim>
            </where>
            ) as count

        </if>
        <if test="countType != null and countType != ''and countType =='2'.toString()">
            select
            (select count(*) from company
            <where>
                <trim prefixOverrides="AND">
                    type!=0 and branch_id=#{branchId} and status=2
                    <if test="date != null">
                        and date_format(retire_net_time,'%Y-%m-%d') = date_format(#{date},'%Y-%m-%d')
                    </if>
                    <if test="beginDate != null and endDate != ''">
                        <![CDATA[
                and  date_format(retire_net_time,'%Y-%m-%d') >= #{beginDate} and date_format(retire_net_time,'%Y-%m-%d') <= #{endDate}
                ]]>
                    </if>
                    <if test="cityId != null">
                        and city_area_id=#{cityId}
                    </if>
                    <if test="salesmanId != null">
                        AND business_manager=#{salesmanId}
                    </if>
                </trim>
            </where>
            ) as count

        </if>
        <if test="countType != null and countType != ''and countType =='3'.toString()">
            select
            (select count(*) from company
            <where>
                <trim prefixOverrides="AND">
                    type!=0 and branch_id=#{branchId} and status=0
                    <if test="date != null">
                        and date_format(created,'%Y-%m-%d') = date_format(#{date},'%Y-%m-%d')
                    </if>
                    <if test="beginDate != null and endDate != ''">
                        <![CDATA[
                and  date_format(created,'%Y-%m-%d') >= #{beginDate} and date_format(created,'%Y-%m-%d') <= #{endDate}
                ]]>
                    </if>
                    <if test="cityId != null">
                        and city_area_id=#{cityId}
                    </if>
                    <if test="salesmanId != null">
                        AND business_manager=#{salesmanId}
                    </if>
                </trim>
            </where>
            ) as count
        </if>
    </select>

    <select id="selectDealerReportSummaryDto"
            resultType="com.lwxf.industry4.webapp.domain.dto.dealer.DealerReportSummaryDto">
        SELECT
        (SELECT count(*) FROM company
        WHERE <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            and branch_id = #{branchId}
        </if>
        ) total,
        (SELECT count(*) FROM company
        WHERE DATE_FORMAT(created, '%Y%m') = DATE_FORMAT(CURDATE( ) ,'%Y%m') and <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            AND branch_id = #{branchId}
        </if>
        ) monthAdd,
        (SELECT count(*) FROM company
        WHERE YEAR(created) = YEAR(NOW( )) and <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            AND branch_id = #{branchId}
        </if>
        ) yearAdd,
        (SELECT count(*) FROM company
        WHERE status = 0 and <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            AND branch_id = #{branchId}
        </if>
        ) intentionTotal,
        (SELECT count(*) FROM company
        WHERE DATE_FORMAT(created, '%Y%m') = DATE_FORMAT(CURDATE( ) ,'%Y%m') AND status = 0 and <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            AND branch_id = #{branchId}
        </if>
        ) intentionMonthAdd,
        (SELECT count(*) FROM company
        WHERE YEAR(created) = YEAR(NOW( )) AND status = 0 and <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            AND branch_id = #{branchId}
        </if>
        ) intentionYearAdd,
        (SELECT count(*) FROM company
        WHERE status = 1 and <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            AND branch_id = #{branchId}
        </if>
        ) normalTotal,
        (SELECT count(*) FROM company
        WHERE DATE_FORMAT(created, '%Y%m') = DATE_FORMAT(CURDATE( ) ,'%Y%m') AND status = 1 and <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            AND branch_id = #{branchId}
        </if>
        ) normalMonthAdd,
        (SELECT count(*) FROM company
        WHERE YEAR(created) = YEAR(NOW( )) AND status = 1 and <![CDATA[ type != 0 ]]>
        <if test="branchId != null">
            AND branch_id = #{branchId}
        </if>
        ) normalYearAdd
    </select>

    <select id="selectDealerReportRankDtoByFilter"
            resultType="com.lwxf.industry4.webapp.domain.dto.dealer.DealerReportRankDto">
        SELECT c.id companyId, c.name companyName, replace(ca.merger_name,',','') companyAddress,
        SUM(co.factory_final_price) orderMoneyTotal, COUNT(*) orderTotal
        FROM custom_order co
        LEFT JOIN company c ON c.id = co.company_id
        LEFT JOIN city_area ca ON ca.id = c.city_area_id
        LEFT JOIN payment p ON p.custom_order_id = co.id
        <where>
            <trim prefixOverrides="AND">
                DATE_FORMAT(p.pay_time, '%Y%m%d') BETWEEN DATE_FORMAT(#{beginTime}, '%Y%m%d') AND
                DATE_FORMAT(#{endTime}, '%Y%m%d') AND (p.status = 1 or p.status = 3)AND p.funds = 31 and
                <![CDATA[ co.status>1 and co.status<8 ]]>
                <if test="type != null">
                    AND co.type = #{type}
                </if>
                <if test="isCharge != null">
                    AND co.is_charge = #{isCharge}
                </if>
                <if test="branchId != null">
                    AND co.branch_id = #{branchId}
                </if>
            </trim>
        </where>
        GROUP BY c.id
        <if test="order!=null">
            ORDER BY ${order} DESC
        </if>
    </select>
</mapper>